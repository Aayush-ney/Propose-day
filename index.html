<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>For My Love üíñ | Kaluu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* MOBILE FIRST DESIGN */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            overscroll-behavior: none;
            touch-action: manipulation;
        }
        
        body {
            background: linear-gradient(135deg, #ffafbd 0%, #ffc3a0 100%);
            background-attachment: fixed;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            color: #5d3d5c;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            position: relative;
        }
        
        /* Main Container */
        .container {
            width: 100%;
            max-width: 100%;
            height: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        /* Cards - Mobile Optimized */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px 20px;
            width: 100%;
            max-width: 95vw;
            text-align: center;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.15),
                0 1px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: none;
            margin: 10px 0;
            animation: fadeIn 0.4s ease-out;
            position: relative;
        }
        
        .card.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        /* Header - Mobile Friendly */
        h1 {
            font-size: clamp(1.8rem, 6vw, 2.2rem);
            margin-bottom: 15px;
            color: #ff4d6d;
            font-weight: 700;
            line-height: 1.2;
            padding: 0 5px;
        }
        
        /* Name Styling */
        .name {
            font-size: clamp(1.2rem, 5vw, 1.4rem);
            font-weight: 600;
            margin: 12px 0;
            padding: 10px 20px;
            background: linear-gradient(45deg, #ff6b9d, #ff8e53);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
            border-radius: 12px;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Paragraphs */
        p {
            font-size: clamp(1rem, 4vw, 1.1rem);
            line-height: 1.6;
            margin: 12px 0;
            color: #444;
            padding: 0 5px;
        }
        
        .highlight {
            color: #ff4d6d;
            font-weight: 600;
            font-size: clamp(1.1rem, 4.5vw, 1.2rem);
            display: inline-block;
            margin: 10px 0;
        }
        
        /* Buttons - Touch Friendly */
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 300px;
            margin: 25px auto 0;
        }
        
        button {
            border: none;
            padding: 18px 24px;
            border-radius: 18px;
            font-size: clamp(1rem, 4.5vw, 1.1rem);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            touch-action: manipulation;
            min-height: 58px;
            user-select: none;
        }
        
        button:active {
            transform: scale(0.97);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        #yesBtn {
            background: linear-gradient(145deg, #ff4d6d, #ff6b9d);
            color: white;
        }
        
        #noBtn {
            background: #f0f0f0;
            color: #666;
        }
        
        #goGameBtn {
            background: linear-gradient(145deg, #36d1dc, #5b86e5);
            color: white;
        }
        
        /* Love Messages */
        .message-container {
            min-height: 180px;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 240, 245, 0.7);
            border-radius: 20px;
            border-left: 4px solid #ff4d6d;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .typing-text {
            font-size: clamp(1rem, 4vw, 1.1rem);
            line-height: 1.8;
            color: #333;
            text-align: left;
        }
        
        /* Game Section */
        .game-area {
            margin: 20px 0;
            width: 100%;
        }
        
        .game-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-box {
            text-align: center;
            background: rgba(255, 255, 255, 0.3);
            padding: 10px 5px;
            border-radius: 15px;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ff4d6d;
            display: block;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #666;
            display: block;
            margin-top: 3px;
        }
        
        .love-meter-container {
            width: 100%;
            height: 25px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            border: 2px solid #ffc3a0;
        }
        
        #loveMeter {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff6b9d, #ff8e53);
            border-radius: 15px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .meter-text {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.9rem;
            color: #666;
        }
        
        /* Game Container */
        #heartContainer {
            position: relative;
            width: 100%;
            height: 350px;
            margin: 20px 0;
            border-radius: 20px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.15);
            border: 2px dashed #ff6b9d;
        }
        
        /* Heart Styling */
        .game-heart {
            position: absolute;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
            user-select: none;
            -webkit-user-select: none;
            animation: pulse 1.5s infinite alternate;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }
        
        /* Bomb Styling */
        .game-bomb {
            position: absolute;
            font-size: 32px;
            cursor: pointer;
            z-index: 10;
            user-select: none;
            -webkit-user-select: none;
            animation: shake 0.5s infinite alternate, rotateBomb 3s linear infinite;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        
        @keyframes shake {
            0% { transform: translateX(-2px); }
            100% { transform: translateX(2px); }
        }
        
        @keyframes rotateBomb {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .bomb-warning {
            background: rgba(255, 50, 50, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
            margin: 10px auto;
            display: inline-block;
            animation: warningPulse 1s infinite;
        }
        
        @keyframes warningPulse {
            0% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.7; transform: scale(1); }
        }
        
        /* Timer */
        .timer {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 77, 109, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .timer.warning {
            background: rgba(255, 100, 50, 0.9);
            animation: timerWarning 1s infinite;
        }
        
        .timer.danger {
            background: rgba(255, 50, 50, 0.9);
            animation: timerDanger 0.5s infinite;
        }
        
        @keyframes timerWarning {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes timerDanger {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Difficulty Level */
        .difficulty {
            display: inline-block;
            background: linear-gradient(45deg, #ff4d6d, #ff8e53);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        /* Floating Hearts Background */
        .floating-heart {
            position: fixed;
            font-size: 20px;
            opacity: 0;
            pointer-events: none;
            z-index: -1;
            animation: floatUp 5s linear forwards;
        }
        
        @keyframes floatUp {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Music Control */
        .music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            z-index: 100;
            border: 2px solid #ff4d6d;
        }
        
        .music-control i {
            font-size: 1.5rem;
            color: #ff4d6d;
        }
        
        /* Music Status */
        .music-status {
            position: fixed;
            bottom: 85px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 8px 12px;
            font-size: 0.8rem;
            color: #ff4d6d;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 99;
        }
        
        .music-status.show {
            display: block;
            animation: fadeInOut 3s forwards;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(10px); }
            20% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }
        
        /* Loading Screen */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ffafbd 0%, #ffc3a0 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }
        
        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ff4d6d;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            font-size: 1.2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            text-align: center;
            padding: 0 20px;
        }
        
        /* Confetti */
        .confetti {
            position: fixed;
            width: 12px;
            height: 12px;
            background: #ff4d6d;
            pointer-events: none;
            opacity: 0.8;
            border-radius: 50%;
        }
        
        /* GAME OVER SCREEN - FIXED */
        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 20px;
            z-index: 50;
            color: white;
            text-align: center;
            padding: 30px 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .game-over.active {
            display: flex;
        }
        
        .game-over-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 1s infinite alternate;
        }
        
        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-15px); }
        }
        
        .game-over h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: #ff4d6d;
        }
        
        .game-over p {
            font-size: 1.1rem;
            color: #fff;
            margin-bottom: 25px;
            line-height: 1.6;
            max-width: 90%;
        }
        
        .game-over-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .retry-btn {
            background: #ff4d6d;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .retry-btn:hover {
            background: #ff3355;
            transform: translateY(-2px);
        }
        
        .back-btn {
            background: #36d1dc;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #25c0cc;
            transform: translateY(-2px);
        }
        
        /* Portrait/Landscape adjustments */
        @media (max-width: 380px) {
            .card {
                padding: 20px 15px;
            }
            
            button {
                padding: 16px 20px;
                min-height: 54px;
            }
            
            #heartContainer {
                height: 300px;
            }
            
            .game-heart, .game-bomb {
                font-size: 26px;
            }
            
            .stat-box {
                padding: 8px 3px;
            }
            
            .stat-value {
                font-size: 1.1rem;
            }
            
            .stat-label {
                font-size: 0.7rem;
            }
            
            .game-over {
                padding: 20px 15px;
            }
            
            .game-over h2 {
                font-size: 1.8rem;
            }
            
            .game-over p {
                font-size: 1rem;
            }
            
            .retry-btn, .back-btn {
                padding: 12px 20px;
                font-size: 1rem;
            }
        }
        
        @media (min-height: 700px) {
            #heartContainer {
                height: 400px;
            }
        }
        
        @media (min-width: 768px) {
            .buttons {
                flex-direction: row;
                max-width: 500px;
            }
            
            button {
                width: auto;
                min-width: 160px;
            }
            
            #heartContainer {
                height: 450px;
            }
            
            .game-stats {
                max-width: 400px;
                margin-left: auto;
                margin-right: auto;
            }
            
            .game-over-buttons {
                flex-direction: row;
            }
        }
        
        /* Hide scrollbar but allow scrolling */
        ::-webkit-scrollbar {
            width: 5px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #ff6b9d;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading" id="loadingScreen">
        <div class="loader"></div>
        <div class="loading-text">Loading our love story... üíñ</div>
    </div>
    
    <!-- Music Control -->
    <div class="music-control" id="musicToggle">
        <i class="fas fa-music"></i>
    </div>
    
    <!-- Music Status -->
    <div class="music-status" id="musicStatus"></div>
    
    <div class="container">
        <!-- Page 1: Proposal -->
        <div id="page1" class="card">
            <h1>Happy Propose Day üíñ</h1>
            <div class="name">Susma Karki üå∏</div>
            <p>From the moment you entered my life, everything became more beautiful.</p>
            <p>Your smile is my favorite view, your laugh is my favorite sound.</p>
            <p class="highlight">I want to spend every day loving you more than the day before.</p>
            <p><strong>Will you make me the happiest person and be mine forever? üíç</strong></p>
            
            <div class="buttons">
                <button id="yesBtn">
                    <i class="fas fa-heart"></i> YES, I WILL! ‚ù§Ô∏è
                </button>
                <button id="noBtn">
                    <i class="fas fa-times"></i> MAYBE LATER
                </button>
            </div>
        </div>
        
        <!-- Page 2: Love Messages -->
        <div id="page2" class="card">
            <h1>My Heart's Message üíå</h1>
            <div class="message-container">
                <div id="loveMessage" class="typing-text"></div>
            </div>
            <div class="buttons">
                <button id="goGameBtn">
                    <i class="fas fa-gamepad"></i> LOVE CHALLENGE üíñ
                </button>
            </div>
        </div>
        
        <!-- Page 3: Mini-game -->
        <div id="page3" class="card">
            <h1>Prove Your Love üíï</h1>
            <p class="difficulty">Try garaüòäüòÅ‚ö°</p>
            <p>Catch hearts üíñ but avoid bombs üí£!</p>
            <div class="bomb-warning">WARNING: Bombs decrease score by 3!</div>
            <p>Collect 35 hearts in <strong>40 seconds</strong> to win! ‚è∞</p>
            
            <div class="game-stats">
                <div class="stat-box">
                    <span class="stat-value" id="score">0</span>
                    <span class="stat-label">Hearts üíñ</span>
                </div>
                <div class="stat-box">
                    <span class="stat-value" id="timeLeft">40</span>
                    <span class="stat-label">Seconds ‚è∞</span>
                </div>
                <div class="stat-box">
                    <span class="stat-value" id="bombs">0</span>
                    <span class="stat-label">Bombs üí£</span>
                </div>
            </div>
            
            <div class="game-area">
                <div class="love-meter-container">
                    <div id="loveMeter"></div>
                </div>
                <div class="meter-text">
                    <span>0%</span>
                    <span>100%</span>
                </div>
            </div>
            
            <div id="heartContainer">
                <div class="timer" id="timer">40s</div>
                <!-- GAME OVER SCREEN - FIXED POSITION -->
                <div class="game-over" id="gameOverScreen">
                    <div class="game-over-icon" id="gameOverIcon">üéâ</div>
                    <h2 id="gameResult">üéâ YOU WIN! üíñ</h2>
                    <p id="gameMessage">Thank you bebu malai maya garna ko lagi</p>
                    <div class="game-over-buttons">
                        <button class="retry-btn" id="retryBtn">
                            <i class="fas fa-redo"></i> Play Again
                        </button>
                        <button class="back-btn" id="backBtn">
                            <i class="fas fa-home"></i> Back to Love
                        </button>
                    </div>
                </div>
            </div>
            <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">Tap hearts üíñ (+1) | Avoid bombs üí£ (-3)</p>
        </div>
    </div>

    <!-- Audio - Using YOUR music file -->
    <audio id="bgMusic" loop>
        <!-- Primary: Your M4A file -->
        <source src="Ji Chanta Matina.m4a" type="audio/mp4">
        <!-- Fallback 1: Try without extension -->
        <source src="Ji Chanta Matina" type="audio/mp4">
        <!-- Fallback 2: MP3 format -->
        <source src="Ji Chanta Matina.mp3" type="audio/mpeg">
        <!-- Fallback 3: Online romantic music -->
        <source src="https://assets.mixkit.co/music/preview/mixkit-romantic-sunset-687.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
        // DOM Elements
        const page1 = document.getElementById('page1');
        const page2 = document.getElementById('page2');
        const page3 = document.getElementById('page3');
        const yesBtn = document.getElementById('yesBtn');
        const noBtn = document.getElementById('noBtn');
        const goGameBtn = document.getElementById('goGameBtn');
        const music = document.getElementById('bgMusic');
        const musicToggle = document.getElementById('musicToggle');
        const musicStatus = document.getElementById('musicStatus');
        const loveMessage = document.getElementById('loveMessage');
        const loveMeter = document.getElementById('loveMeter');
        const heartContainer = document.getElementById('heartContainer');
        const loadingScreen = document.getElementById('loadingScreen');
        const scoreDisplay = document.getElementById('score');
        const timeDisplay = document.getElementById('timeLeft');
        const bombsDisplay = document.getElementById('bombs');
        const timerDisplay = document.getElementById('timer');
        
        // GAME OVER ELEMENTS - FIXED SELECTORS
        const gameOverScreen = document.getElementById('gameOverScreen');
        const gameOverIcon = document.getElementById('gameOverIcon');
        const gameResult = document.getElementById('gameResult');
        const gameMessage = document.getElementById('gameMessage');
        const retryBtn = document.getElementById('retryBtn');
        const backBtn = document.getElementById('backBtn');
        
        // Game Variables
        let yesClicked = false;
        let gameStarted = false;
        let musicPlaying = false;
        let gameActive = false;
        
        // Game Stats
        let score = 0;
        let timeLeft = 40;
        let bombsHit = 0;
        let gameTimer = null;
        let objectCreationInterval = null;
        let activeObjects = [];
        let bombChance = 0.2;
        let bombPenalty = 3;
        let winThreshold = 35;
        
        // Love messages
        const messages = [
            "My dearest Susma, üíñ",
            "From the first moment I saw you, I knew you were special.",
            "Every day with you feels like a beautiful dream.",
            "Your smile lights up my world like nothing else.",
            "I love the way you laugh, the way you care, everything about you.",
            "You're not just my love, you're my best friend, my partner, my everything.",
            "I promise to love you more with each passing day.",
            "Will you make me the happiest man and be mine forever?",
            "I love you more than words can express. üíï",
            "Forever yours... ‚ù§Ô∏è"
        ];
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            init();
        });
        
        function init() {
            // Hide loading screen and show page immediately
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                page1.classList.add('active');
            }, 800);
            
            // Start music immediately
            startMusicImmediately();
            
            setupEventListeners();
            setupTouchSupport();
            createFloatingHearts();
        }
        
        // Music player
        function startMusicImmediately() {
            music.volume = 0.7;
            music.muted = false;
            
            showMusicStatus("Loading your song... üéµ");
            
            music.load();
            
            music.addEventListener('canplaythrough', function() {
                showMusicStatus("Playing: Ji Chanta Matina üé∂");
                
                const playPromise = music.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        musicPlaying = true;
                        musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                        showMusicStatus("Music playing! üíñ");
                    }).catch(error => {
                        console.log("Auto-play prevented:", error);
                        showMusicStatus("Tap to play music üëÜ");
                    });
                }
            });
            
            music.addEventListener('play', function() {
                musicPlaying = true;
                musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
            });
            
            music.addEventListener('pause', function() {
                musicPlaying = false;
                musicToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
            });
            
            music.addEventListener('error', function(e) {
                console.error("Audio error:", music.error);
                showMusicStatus("Using romantic music üéµ");
            });
            
            const enableAudio = () => {
                if (!musicPlaying) {
                    music.play().then(() => {
                        musicPlaying = true;
                        musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                        showMusicStatus("Music started! üíñ");
                    });
                }
            };
            
            document.addEventListener('click', enableAudio, { once: true });
            document.addEventListener('touchstart', enableAudio, { once: true });
        }
        
        function showMusicStatus(message) {
            musicStatus.textContent = message;
            musicStatus.classList.add('show');
            setTimeout(() => {
                musicStatus.classList.remove('show');
            }, 3000);
        }
        
        // Setup Event Listeners
        function setupEventListeners() {
            // YES Button
            yesBtn.addEventListener('click', handleYesClick);
            yesBtn.addEventListener('touchend', handleYesClick);
            
            // NO Button
            noBtn.addEventListener('touchstart', moveNoButton);
            noBtn.addEventListener('click', handleNoClick);
            
            // Game Button
            goGameBtn.addEventListener('click', () => switchToGame());
            goGameBtn.addEventListener('touchend', () => switchToGame());
            
            // Music Toggle
            musicToggle.addEventListener('click', toggleMusic);
            musicToggle.addEventListener('touchend', toggleMusic);
            
            // RETRY BUTTON - FIXED EVENT LISTENER
            retryBtn.addEventListener('click', restartGame);
            
            // BACK BUTTON - FIXED EVENT LISTENER
            backBtn.addEventListener('click', goBackToLove);
        }
        
        // Go back to love messages
        function goBackToLove() {
            gameOverScreen.classList.remove('active');
            switchPage(page3, page2);
        }
        
        // Setup Touch Support
        function setupTouchSupport() {
            document.addEventListener('contextmenu', (e) => e.preventDefault());
        }
        
        // Handle YES click/tap
        function handleYesClick(e) {
            e.preventDefault();
            if (yesClicked) return;
            yesClicked = true;
            
            if (!musicPlaying) {
                music.volume = 0.7;
                music.play().then(() => {
                    musicPlaying = true;
                    musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                });
            }
            
            switchPage(page1, page2);
            typeMessages(0);
        }
        
        // Handle NO button
        function handleNoClick() {
            noBtn.innerHTML = '<i class="fas fa-heart-broken"></i> PLEASE SAY YES';
            noBtn.style.background = 'linear-gradient(145deg, #ff9999, #ff6666)';
            noBtn.style.color = 'white';
            setTimeout(() => {
                noBtn.innerHTML = '<i class="fas fa-times"></i> MAYBE LATER';
                noBtn.style.background = '#f0f0f0';
                noBtn.style.color = '#666';
            }, 1500);
        }
        
        // Move NO button on mobile touch
        function moveNoButton(e) {
            e.preventDefault();
            const card = page1.getBoundingClientRect();
            const maxX = card.width - noBtn.offsetWidth - 30;
            const maxY = card.height - noBtn.offsetHeight - 30;
            
            const randomX = Math.random() * maxX;
            const randomY = Math.random() * maxY;
            
            noBtn.style.position = 'absolute';
            noBtn.style.left = randomX + 'px';
            noBtn.style.top = randomY + 'px';
            noBtn.style.transform = `rotate(${Math.random() * 30 - 15}deg)`;
            noBtn.style.transition = 'all 0.3s ease';
        }
        
        // Toggle Music
        function toggleMusic(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (musicPlaying) {
                music.pause();
                showMusicStatus("Music paused");
            } else {
                music.volume = 0.7;
                music.play().then(() => {
                    musicPlaying = true;
                    showMusicStatus("Music playing");
                }).catch(error => {
                    showMusicStatus("Tap page to enable audio");
                });
            }
        }
        
        // Switch to Game
        function switchToGame() {
            switchPage(page2, page3);
            startLoveGame();
        }
        
        // Switch Pages
        function switchPage(fromPage, toPage) {
            fromPage.classList.remove('active');
            setTimeout(() => {
                toPage.classList.add('active');
            }, 300);
        }
        
        // Type Messages Effect
        function typeMessages(index) {
            if (index >= messages.length) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-line';
            loveMessage.appendChild(messageDiv);
            
            const text = messages[index];
            let charIndex = 0;
            
            function typeChar() {
                if (charIndex < text.length) {
                    messageDiv.innerHTML += text.charAt(charIndex);
                    charIndex++;
                    setTimeout(typeChar, 50);
                } else {
                    messageDiv.innerHTML += '<br><br>';
                    setTimeout(() => typeMessages(index + 1), 800);
                }
            }
            
            typeChar();
        }
        
        // Start Love Game
        function startLoveGame() {
            if (gameStarted) return;
            
            // Reset game state
            gameStarted = true;
            gameActive = true;
            score = 0;
            timeLeft = 40;
            bombsHit = 0;
            activeObjects = [];
            
            // Clear game over screen
            gameOverScreen.classList.remove('active');
            
            // Clear container but keep timer and game over screen
            const timer = document.querySelector('.timer');
            const gameOver = document.querySelector('.game-over');
            heartContainer.innerHTML = '';
            if (timer) heartContainer.appendChild(timer);
            if (gameOver) heartContainer.appendChild(gameOver);
            
            // Update displays
            updateStats();
            timerDisplay.textContent = `${timeLeft}s`;
            timerDisplay.className = 'timer';
            
            // Reset love meter
            loveMeter.style.width = '0%';
            loveMeter.textContent = '';
            
            // Clear any existing intervals
            if (gameTimer) clearInterval(gameTimer);
            if (objectCreationInterval) clearInterval(objectCreationInterval);
            
            // Start game timer
            gameTimer = setInterval(updateTimer, 1000);
            
            // Start creating game objects
            createGameObjects();
            
            // Start object movement
            startObjectMovement();
        }
        
        // Create game objects
        function createGameObjects() {
            if (!gameActive) return;
            
            // Clear any existing interval
            if (objectCreationInterval) clearInterval(objectCreationInterval);
            
            // Create objects at regular intervals
            objectCreationInterval = setInterval(() => {
                if (!gameActive) return;
                
                // Create 1-3 objects at once
                const objectCount = Math.floor(Math.random() * 2) + 1;
                
                for (let i = 0; i < objectCount; i++) {
                    setTimeout(() => {
                        if (gameActive) {
                            const isBomb = Math.random() < bombChance;
                            createGameObject(isBomb);
                        }
                    }, i * 200);
                }
            }, 800); // Create objects every 800ms
        }
        
        // Create a single game object
        function createGameObject(isBomb) {
            if (!gameActive) return;
            
            const object = document.createElement('div');
            const id = Date.now() + Math.random();
            
            if (isBomb) {
                object.innerHTML = 'üí£';
                object.className = 'game-bomb';
                object.title = 'Avoid! -3 points';
            } else {
                object.innerHTML = 'üíñ';
                object.className = 'game-heart';
                object.title = 'Collect! +1 point';
            }
            
            // Random starting position
            const startX = Math.random() * 75 + 10;
            const startY = Math.random() * 70 + 10;
            object.style.left = startX + '%';
            object.style.top = startY + '%';
            
            // Random movement
            const speed = 0.5 + Math.random() * 1.5;
            const angle = Math.random() * Math.PI * 2;
            const moveX = Math.cos(angle) * speed;
            const moveY = Math.sin(angle) * speed;
            
            const objectData = {
                element: object,
                id: id,
                isBomb: isBomb,
                x: startX,
                y: startY,
                moveX: moveX,
                moveY: moveY,
                life: 4000,
                collected: false
            };
            
            activeObjects.push(objectData);
            
            // Click/Touch events
            object.addEventListener('click', (e) => {
                e.preventDefault();
                handleObjectClick(objectData);
            });
            
            object.addEventListener('touchend', (e) => {
                e.preventDefault();
                handleObjectClick(objectData);
            });
            
            heartContainer.appendChild(object);
            
            // Remove object after lifespan
            setTimeout(() => {
                if (!objectData.collected && object.parentNode) {
                    object.remove();
                    activeObjects = activeObjects.filter(obj => obj.id !== id);
                }
            }, objectData.life);
        }
        
        // Handle object click
        function handleObjectClick(objectData) {
            if (objectData.collected || !gameActive) return;
            
            objectData.collected = true;
            
            if (objectData.isBomb) {
                // BOMB clicked
                score = Math.max(0, score - bombPenalty);
                bombsHit++;
                createBombExplosion(objectData.element.getBoundingClientRect());
                showMusicStatus("Bomb! -3 points üí£");
            } else {
                // HEART clicked
                score++;
                createHeartAnimation(objectData.element.getBoundingClientRect());
            }
            
            // Remove object
            if (objectData.element.parentNode) {
                objectData.element.remove();
                activeObjects = activeObjects.filter(obj => obj.id !== objectData.id);
            }
            
            // Update game state
            updateStats();
            
            // Update love meter
            const progress = Math.min((score / winThreshold) * 100, 100);
            loveMeter.style.width = progress + '%';
            loveMeter.textContent = Math.round(progress) + '%';
            
            // Check win condition
            if (score >= winThreshold) {
                winGame();
            }
        }
        
        // Update moving objects
        function updateMovingObjects() {
            if (!gameActive) return;
            
            activeObjects.forEach(obj => {
                if (obj.collected) return;
                
                // Move object
                obj.x += obj.moveX;
                obj.y += obj.moveY;
                
                // Bounce off walls
                if (obj.x < 5 || obj.x > 90) {
                    obj.moveX *= -1;
                    obj.x = Math.max(5, Math.min(90, obj.x));
                }
                if (obj.y < 5 || obj.y > 85) {
                    obj.moveY *= -1;
                    obj.y = Math.max(5, Math.min(85, obj.y));
                }
                
                // Update position
                obj.element.style.left = obj.x + '%';
                obj.element.style.top = obj.y + '%';
            });
            
            // Continue animation
            if (gameActive) {
                requestAnimationFrame(updateMovingObjects);
            }
        }
        
        // Start object movement
        function startObjectMovement() {
            updateMovingObjects();
        }
        
        // Update game stats
        function updateStats() {
            scoreDisplay.textContent = score;
            timeDisplay.textContent = timeLeft;
            bombsDisplay.textContent = bombsHit;
        }
        
        // Update timer
        function updateTimer() {
            if (!gameActive) return;
            
            timeLeft--;
            timerDisplay.textContent = `${timeLeft}s`;
            
            // Update timer styling
            if (timeLeft <= 10) {
                timerDisplay.className = 'timer danger';
            } else if (timeLeft <= 20) {
                timerDisplay.className = 'timer warning';
            }
            
            // Increase bomb chance as time runs out
            if (timeLeft <= 20) {
                bombChance = 0.3;
            }
            if (timeLeft <= 10) {
                bombChance = 0.4;
            }
            
            if (timeLeft <= 0) {
                endGame();
            }
        }
        
        // WIN THE GAME - SHOWS MESSAGE
        function winGame() {
            gameActive = false;
            clearInterval(gameTimer);
            clearInterval(objectCreationInterval);
            
            // Set win message
            gameOverIcon.textContent = 'üéâ';
            gameResult.textContent = 'üéâ YOU WIN! üíñ';
            gameMessage.textContent = `Amazing! You collected ${score} hearts!\nOnly hit ${bombsHit} bombs!\n\n thank you bebu malai maya garna ko lagiüíï`;
            
            // Show game over screen
            gameOverScreen.classList.add('active');
            
            // Show confetti
            showConfetti();
            
            // Play win sound
            playWinSound();
            
            // Clear all objects
            clearAllObjects();
            
            // Show success message
            setTimeout(() => {
                showMusicStatus("You won my heart! üíñ");
            }, 1000);
        }
        
        // END GAME (LOSE) - SHOWS MESSAGE
        function endGame() {
            gameActive = false;
            clearInterval(gameTimer);
            clearInterval(objectCreationInterval);
            
            // Check if player won or lost
            if (score >= winThreshold) {
                winGame();
                return;
            }
            
            // Set lose message
            gameOverIcon.textContent = 'üíî';
            gameResult.textContent = '‚è∞ TIME\'S UP!';
            gameMessage.textContent = `You collected ${score} hearts (need ${winThreshold}).\nHit ${bombsHit} bombs.\n\nDon't give up! Try again to win my heart! üíò`;
            
            // Show game over screen
            gameOverScreen.classList.add('active');
            
            // Clear all objects
            clearAllObjects();
            
            // Show encouragement message
            setTimeout(() => {
                showMusicStatus("Try again! You can do it! üí™");
            }, 1000);
        }
        
        // Clear all game objects
        function clearAllObjects() {
            // Remove all objects from screen
            const objects = heartContainer.querySelectorAll('.game-heart, .game-bomb');
            objects.forEach(obj => obj.remove());
            
            // Clear active objects array
            activeObjects = [];
        }
        
        // RESTART GAME - FIXED FUNCTION
        function restartGame() {
            console.log("Restart game called");
            
            // Hide game over screen
            gameOverScreen.classList.remove('active');
            
            // Reset game started flag
            gameStarted = false;
            
            // Clear any existing intervals
            if (gameTimer) clearInterval(gameTimer);
            if (objectCreationInterval) clearInterval(objectCreationInterval);
            
            // Start fresh game
            startLoveGame();
        }
        
        // Create Heart Animation
        function createHeartAnimation(position) {
            const heart = document.createElement('div');
            heart.innerHTML = 'üíñ';
            heart.style.position = 'fixed';
            heart.style.left = position.x + 'px';
            heart.style.top = position.y + 'px';
            heart.style.fontSize = '35px';
            heart.style.opacity = '1';
            heart.style.transition = 'all 0.6s ease-out';
            heart.style.zIndex = '1000';
            heart.style.pointerEvents = 'none';
            
            document.body.appendChild(heart);
            
            setTimeout(() => {
                heart.style.transform = 'translateY(-70px) scale(1.8)';
                heart.style.opacity = '0';
            }, 10);
            
            setTimeout(() => {
                heart.remove();
            }, 700);
        }
        
        // Create Bomb Explosion
        function createBombExplosion(position) {
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.innerHTML = 'üí•';
                particle.style.position = 'fixed';
                particle.style.left = position.x + 'px';
                particle.style.top = position.y + 'px';
                particle.style.fontSize = '20px';
                particle.style.opacity = '1';
                particle.style.zIndex = '1000';
                particle.style.pointerEvents = 'none';
                
                document.body.appendChild(particle);
                
                const angle = (Math.PI * 2 * i) / 8;
                const distance = 50;
                
                particle.animate([
                    { transform: 'scale(1) rotate(0deg)', opacity: 1 },
                    { transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(1.5) rotate(180deg)`, opacity: 0 }
                ], {
                    duration: 800,
                    easing: 'ease-out'
                });
                
                setTimeout(() => {
                    particle.remove();
                }, 800);
            }
        }
        
        // Play win sound
        function playWinSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log("Web Audio not supported");
            }
        }
        
        // Create Floating Hearts Background
        function createFloatingHearts() {
            setInterval(() => {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.innerHTML = Math.random() > 0.5 ? '‚ù§Ô∏è' : 'üíñ';
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.fontSize = Math.random() * 15 + 15 + 'px';
                heart.style.color = getRandomHeartColor();
                heart.style.pointerEvents = 'none';
                
                document.body.appendChild(heart);
                
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.remove();
                    }
                }, 5000);
            }, 500);
        }
        
        // Show Confetti
        function showConfetti() {
            for (let i = 0; i < 120; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-20px';
                    confetti.style.backgroundColor = getRandomHeartColor();
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    confetti.style.pointerEvents = 'none';
                    
                    document.body.appendChild(confetti);
                    
                    const animation = confetti.animate([
                        { transform: `translateY(0) rotate(0deg)`, opacity: 1 },
                        { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                    ], {
                        duration: Math.random() * 2000 + 1500,
                        easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                    });
                    
                    animation.onfinish = () => {
                        if (confetti.parentNode) {
                            confetti.remove();
                        }
                    };
                }, i * 20);
            }
        }
        
        // Helper function for random heart colors
        function getRandomHeartColor() {
            const colors = ['#ff4d6d', '#ff6b9d', '#ff8e53', '#ffb347', '#ff9999', '#ff6666', '#ff85a2', '#ff9770'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
    </script>
</body>
</html>
